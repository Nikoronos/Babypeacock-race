<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doge Match ‚Äì Space Run</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      background:#04010b;
      color:#fff;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:10px;
    }
    .wrap{
      width:100%;
      max-width:480px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
    }

    /* BA≈ûLIK */
    .title{
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .title h1{
      font-size:20px;
      font-weight:800;
      letter-spacing:.04em;
    }
    .title span{
      font-size:10px;
      opacity:.9;
    }
    .badge{
      margin-top:2px;
      padding:3px 9px;
      border-radius:999px;
      background:rgba(0,0,0,.7);
      font-size:9px;
      display:inline-flex;
      gap:5px;
      align-items:center;
    }
    .badge strong{color:#ffce3a;}

    /* DOGE RACE BAR */
    .race-wrap{
      width:100%;
      margin-top:4px;
    }
    .race-label{
      font-size:9px;
      display:flex;
      justify-content:space-between;
      gap:6px;
      margin-bottom:3px;
    }
    .race-label span strong{color:#ffce3a;}
    .race-bar{
      position:relative;
      width:100%;
      height:40px;
      border-radius:20px;
      padding:4px 8px;
      background:
        radial-gradient(circle at 0 0,rgba(255,255,255,.12),transparent 55%),
        linear-gradient(to right,#2a0044,#4b178b,#ff4e4e);
      box-shadow:0 6px 16px rgba(0,0,0,.9);
      overflow:hidden;
    }
    .finish-tag{
      position:absolute;
      right:6px;
      top:6px;
      padding:2px 6px;
      border-radius:10px;
      font-size:8px;
      background:rgba(0,0,0,.85);
      border:1px solid #ffce3a;
      color:#ffce3a;
    }
    .doge-marker{
      position:absolute;
      left:6px;
      bottom:4px;
      width:40px;
      height:32px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      background:transparent;
      box-shadow:none;
      transition:transform .2s ease-out;
    }
    .doge-marker video{
      height:30px;
      border-radius:999px;
      background:transparent;
      display:block;
      /* siyah fonu yumu≈üatmak i√ßin */
      mix-blend-mode:screen;
      filter:brightness(1.4) contrast(1.2);
    }

    /* MATCH-3 BOARD */
    .board-wrap{
      margin-top:6px;
      padding:6px;
      border-radius:16px;
      background:radial-gradient(circle at 0 0,rgba(255,255,255,.06),transparent 70%);
      box-shadow:0 10px 24px rgba(0,0,0,.95);
    }
    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      font-size:9px;
      margin-bottom:4px;
    }
    #score{color:#ffce3a;font-weight:700;}
    #moves{color:#7dffb4;font-weight:700;}

    .board{
      width:100%;
      max-width:360px;
      aspect-ratio:1/1;
      display:grid;
      grid-template-columns:repeat(8,1fr);
      grid-template-rows:repeat(8,1fr);
      gap:2px;
      touch-action:manipulation;
    }

    .cell{
      position:relative;
      border-radius:8px;
      background:rgba(4,3,18,.98);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      overflow:hidden;
    }

    .gem{
      width:70%;
      height:70%;
      border-radius:50%;
      box-shadow:0 0 8px rgba(0,0,0,.6);
      transform:scale(1);
      transition:transform .08s, opacity .08s;
    }
    .cell.selected .gem{
      transform:scale(1.1);
      box-shadow:0 0 10px rgba(255,255,255,.7);
    }
    .cell.pop .gem{
      animation:pop .18s forwards;
    }
    @keyframes pop{
      to{transform:scale(0);opacity:0;}
    }

    /* PATLAMA (mevye efekti) */
    .cell.boom::after{
      content:"";
      position:absolute;
      left:50%;
      top:50%;
      width:140%;
      height:140%;
      transform:translate(-50%,-50%) scale(0);
      border-radius:50%;
      pointer-events:none;
      background:radial-gradient(circle,
        rgba(255,255,255,.95) 0,
        rgba(255,255,255,.7) 25%,
        rgba(255,255,255,0) 70%);
      opacity:.8;
      animation:boom .25s ease-out forwards;
    }
    @keyframes boom{
      to{
        transform:translate(-50%,-50%) scale(1.4);
        opacity:0;
      }
    }

    /* renkler */
    .r{background:linear-gradient(145deg,#ff3b3b,#ff9f7b);}
    .g{background:linear-gradient(145deg,#38ff9c,#1bbf6b);}
    .b{background:linear-gradient(145deg,#4dd0ff,#216bff);}
    .y{background:linear-gradient(145deg,#ffe45d,#ffb347);}
    .p{background:linear-gradient(145deg,#ff8ef2,#c547ff);}
    .o{background:linear-gradient(145deg,#ffa141,#ff5b2e);}

    .hint{
      margin-top:4px;
      font-size:9px;
      text-align:center;
      opacity:.9;
      max-width:360px;
    }

    /* OVERLAY */
    .overlay{
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      background:rgba(0,0,0,.9);
      padding:10px 16px;
      border-radius:14px;
      font-size:11px;
      line-height:1.5;
      box-shadow:0 0 24px rgba(0,0,0,1);
      display:none;
      text-align:center;
      z-index:50;
    }
    .overlay strong{color:#ffce3a;}
    .btn{
      margin-top:6px;
      padding:5px 10px;
      border-radius:999px;
      border:none;
      background:#ffce3a;
      color:#000;
      font-size:10px;
      font-weight:600;
      cursor:pointer;
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h1>Doge Match</h1>
    <span>Candy tarzƒ± uzay tahtasƒ±. 3‚Äôl√º e≈üle≈ütir, Doge‚Äôu finish‚Äôe ta≈üƒ±.</span>
    <div class="badge">
      <span>Babypeacock universe</span>
      <span>¬∑</span>
      <strong>Mobile first</strong>
    </div>
  </div>

  <!-- DOGE PROGRESS -->
  <div class="race-wrap">
    <div class="race-label">
      <span>3 aynƒ± meyve ‚Üí patlar, Doge ilerler.</span>
      <span>ƒ∞lerleme: <strong id="progressText">0%</strong></span>
    </div>
    <div class="race-bar" id="raceBar">
      <div class="doge-marker" id="dogeMarker">
        <!-- Doge mp4 animasyonu -->
        <video id="dogeVideo" src="Doge.mp4" autoplay loop muted playsinline></video>
      </div>
      <div class="finish-tag">FINISH</div>
    </div>
  </div>

  <!-- MATCH-3 BOARD -->
  <div class="board-wrap">
    <div class="top-row">
      <div>Skor: <span id="score">0</span></div>
      <div>Hamle: <span id="moves">‚àû</span></div>
    </div>
    <div class="board" id="board"></div>
    <div class="hint">
      Tahtaya dokun: √∂nce bir ta≈üƒ± se√ß, sonra yanƒ±ndakiyle yer deƒüi≈ütir.
      Sadece <strong>yan yana</strong> ta≈ülar deƒüi≈üir ve hamlen ma√ß olu≈üturmalƒ±.
      Her patlamada skor <strong>2‚Åø</strong> artar (n = patlayan ta≈ü sayƒ±sƒ±) ve Doge ilerler.
      %100 olunca Doge finishe ula≈üƒ±r.
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div id="overlayText"></div>
  <button class="btn" onclick="restart()">Tekrar Oyna</button>
</div>

<script>
/* ==== Match-3 + Doge Progress (Mobil) ==== */

const rows = 8;
const cols = 8;
const types = ['r','g','b','y','p','o']; // renkler
const boardEl = document.getElementById('board');
const scoreEl = document.getElementById('score');
const overlay = document.getElementById('overlay');
const overlayText = document.getElementById('overlayText');
const dogeMarker = document.getElementById('dogeMarker');
const raceBar = document.getElementById('raceBar');
const progressText = document.getElementById('progressText');

let board = [];
let selected = null;
let animating = false;
let score = 0;
let progress = 0; // 0..1

function init(){
  board = [];
  boardEl.innerHTML = '';
  score = 0;
  progress = 0;
  updateScore(0);
  updateProgress(0);
  selected = null;
  animating = false;
  overlay.style.display = "none";

  for(let r=0;r<rows;r++){
    const row = [];
    for(let c=0;c<cols;c++){
      const t = randomType();
      row.push(t);
      const cell = createCell(r,c,t);
      boardEl.appendChild(cell);
    }
    board.push(row);
  }

  // ba≈ülangƒ±√ßta varsa otomatik e≈üle≈ümeleri temizle
  resolveBoard();
}

function randomType(){
  return types[Math.floor(Math.random()*types.length)];
}

function createCell(r,c,t){
  const cell = document.createElement('div');
  cell.className = 'cell';
  cell.dataset.r = r;
  cell.dataset.c = c;

  const gem = document.createElement('div');
  gem.className = 'gem ' + t;
  cell.appendChild(gem);

  cell.addEventListener('pointerdown', ()=>onCellTap(r,c));
  return cell;
}

function onCellTap(r,c){
  if(animating) return;
  const cell = getCell(r,c);

  if(!selected){
    selected = {r,c};
    cell.classList.add('selected');
  }else{
    const same = (selected.r === r && selected.c === c);
    if(same){
      cell.classList.remove('selected');
      selected = null;
      return;
    }
    const isNeighbor =
      (Math.abs(selected.r - r) + Math.abs(selected.c - c) === 1);

    if(!isNeighbor){
      // eskiyi kaldƒ±r, yeni se√ß
      getCell(selected.r,selected.c).classList.remove('selected');
      selected = {r,c};
      cell.classList.add('selected');
      return;
    }

    // kom≈üu -> swap dene
    swapAndCheck(selected.r,selected.c,r,c);
    getCell(selected.r,selected.c).classList.remove('selected');
    selected = null;
  }
}

function getCell(r,c){
  return boardEl.children[r*cols + c];
}

function swapTypes(r1,c1,r2,c2){
  const tmp = board[r1][c1];
  board[r1][c1] = board[r2][c2];
  board[r2][c2] = tmp;
}

function refreshVisual(){
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell = getCell(r,c);
      cell.className = 'cell';
      const gem = cell.firstChild;
      gem.className = 'gem ' + board[r][c];
      gem.style.opacity = 1;
      gem.style.transform = 'scale(1)';
    }
  }
}

function swapAndCheck(r1,c1,r2,c2){
  animating = true;
  swapTypes(r1,c1,r2,c2);
  refreshVisual();

  const matches = findMatches();
  if(matches.length === 0){
    // ge√ßersiz hamle, geri al
    setTimeout(()=>{
      swapTypes(r1,c1,r2,c2);
      refreshVisual();
      animating = false;
    },120);
  }else{
    handleMatches(matches);
  }
}

function findMatches(){
  const toClear = [];

  // yatay
  for(let r=0;r<rows;r++){
    let count = 1;
    for(let c=1;c<=cols;c++){
      const curr = c<cols ? board[r][c] : null;
      const prev = board[r][c-1];
      if(curr && curr === prev){
        count++;
      }else{
        if(count>=3){
          for(let k=0;k<count;k++){
            toClear.push({r, c:c-1-k});
          }
        }
        count = 1;
      }
    }
  }

  // dikey
  for(let c=0;c<cols;c++){
    let count = 1;
    for(let r=1;r<=rows;r++){
      const curr = r<rows ? board[r][c] : null;
      const prev = board[r-1][c];
      if(curr && curr === prev){
        count++;
      }else{
        if(count>=3){
          for(let k=0;k<count;k++){
            toClear.push({r:r-1-k, c});
          }
        }
        count = 1;
      }
    }
  }

  // unique
  const seen = new Set();
  const unique = [];
  for(const p of toClear){
    const key = p.r + '-' + p.c;
    if(!seen.has(key)){
      seen.add(key);
      unique.push(p);
    }
  }
  return unique;
}

function handleMatches(matches){
  if(matches.length === 0){
    animating = false;
    return;
  }

  // patlama + pop animasyonu
  matches.forEach(p=>{
    const cell = getCell(p.r,p.c);
    cell.classList.add('pop','boom');
  });

  // PUAN: 2^n, n = patlayan ta≈ü sayƒ±sƒ± (tek hamlede)
  const n = matches.length;
  const gain = Math.pow(2, n);
  updateScore(score + gain);

  // Doge ilerlemesi
  advanceProgress(n);

  setTimeout(()=>{
    // tahtadan sil
    matches.forEach(p=>{
      board[p.r][p.c] = null;
    });

    // s√ºtun s√ºtun a≈üaƒüƒ± kaydƒ±r (gravity)
    for(let c=0;c<cols;c++){
      let writeRow = rows - 1;
      for(let r=rows-1;r>=0;r--){
        if(board[r][c]){
          board[writeRow][c] = board[r][c];
          if(writeRow !== r) board[r][c] = null;
          writeRow--;
        }
      }
      // yukarƒ±yƒ± yeni ta≈üla doldur
      for(let r=writeRow;r>=0;r--){
        board[r][c] = randomType();
      }
    }

    refreshVisual();

    // zincirleme e≈üle≈üme varsa devam
    const more = findMatches();
    if(more.length>0){
      handleMatches(more);
    }else{
      animating = false;
    }
  },180);
}

function advanceProgress(clearedCount){
  if(progress >= 1) return;
  // her ta≈ü i√ßin k√º√ß√ºk adƒ±m: ayarlayabilirsin
  const stepPerTile = 0.01; 
  progress += clearedCount * stepPerTile;
  if(progress > 1) progress = 1;
  updateProgress(progress);
  if(progress >= 1){
    showWin();
  }
}

function updateScore(v){
  score = v;
  scoreEl.textContent = score;
}

function updateProgress(p){
  const percent = Math.round(p * 100);
  progressText.textContent = percent + "%";
  const maxMove = raceBar.clientWidth - dogeMarker.offsetWidth - 26; // finish mesafesi
  dogeMarker.style.transform = `translateX(${maxMove * p}px)`;
}

function showWin(){
  overlayText.innerHTML = "<strong>Doge FINISH!</strong><br>Meyve patlata patlata yarƒ±≈üƒ± kazandƒ±n. üêïüöÄ";
  overlay.style.display = "block";
}

function restart(){
  init();
}

/* Ba≈ülangƒ±√ß: otomatik board kur */
init();
</script>
</body>
</html>
